#!/opt/homebrew/bin/bash

# Load dictionary into memory
declare -A DICT
while IFS= read -r w; do
    DICT["$w"]=1
done < "$DEFAULT_DICT"

in_dict() {
    local w="${1^^}"
    [[ ${DICT["$w"]+_} ]]
}

items=("$@")
len="${#items[@]}"
: > .quartiles.txt   # truncate

# Show arguments for typos
for (( i=0; i< len/4; i++ )); do
    big=""
    for (( j=0; j<4; j++ )); do
        index=$(( i*4 + j ))
        echo -n "${items[index]}"
        big+="${items[index]}"
        [[ $j -lt 3 ]] && echo -n "-"
    done
    if ! in_dict "$big"; then
        echo -n " (not found)"
    else
        echo "${big^^}" >> .quartiles.txt
    fi
    echo
done
echo "=================="

# Generate list of words
for (( i=0; i<len; i++ )); do
    echo "${items[i]}" >> .quartiles.txt
    for (( j=0; j<len; j++ )); do
        (( j == i )) && continue        # BUGFIX: use arithmetic, not bare j
        echo "${items[i]}${items[j]}" >> .quartiles.txt
        for (( k=0; k<len; k++ )); do
            (( k == i || k == j )) && continue
            echo "${items[i]}${items[j]}${items[k]}" >> .quartiles.txt
        done
    done
done

touch .q
while read -r wordl; do
    [[ ${#wordl} -lt 3 ]] && continue
    word="${wordl^^}"

    if in_dict "$word"; then
        echo "$wordl"

    elif [[ "${word: -1}" == "S" ]]; then
        # fund found but not funds
        in_dict "${word:0:${#word}-1}" && echo "${wordl}*"

    elif [[ "${word: -3}" == "IES" ]]; then
        # body found but not bodies
        in_dict "${word:0:${#word}-3}Y" && echo "${wordl}*"
        # money found but not monies
        in_dict "${word:0:${#word}-3}EY" && echo "${wordl}*"

    elif [[ "${word: -3}" == "ING" ]]; then
        # grouse found but not grousing
        in_dict "${word:0:${#word}-3}E" && echo "${wordl}*"
        in_dict "${word:0:${#word}-3}" && echo "${wordl}*"

    elif [[ "${word: -2}" == "ED" ]]; then
        # conjure found but not conjured, burp but not burped
        in_dict "${word:0:${#word}-1}" && echo "${wordl}*"
        in_dict "${word:0:${#word}-2}" && echo "${wordl}*"

    elif [[ "${word: -2}" == "IE" ]]; then
        # boot found but not bootie
        in_dict "${word:0:${#word}-2}" && echo "${wordl}*"

    elif [[ "${word: -2}" == "EE" ]]; then  # BUGFIX: add '; then'
        # mentor found but not mentee
        in_dict "${word:0:${#word}-2}OR" && echo "${wordl}*"

    elif [[ "${word: -3}" == "IZE" ]]; then  # BUGFIX: add '; then'
        # comment says penal/penalize â€“ adjust to taste
        in_dict "${word:0:${#word}-3}" && echo "${wordl}*"
    fi
done < .quartiles.txt >> .q

sort -u .q | tr '[:upper:]' '[:lower:]' > .quartiles.txt
rm .q
echo "$(echo $(cat .quartiles.txt | wc -l)) words found."
cat .quartiles.txt
